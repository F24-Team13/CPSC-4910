{% block content %}
<h2>Manage Your Reward System</h2>

<!-- Two-column layout -->
<div style="display: flex; justify-content: space-between;">

    <!-- Column for displaying active behaviors -->
    <div style="flex: 70%; padding-right: 20px;">
        <h1>Your Behaviors</h1>
        
        <!-- Check if there are any behaviors -->
        {% if behaviors %}
            <div class="behavior-list">
                <!-- Loop through each behavior and display its details -->
                {% for behavior in behaviors %}
                    <div class="behavior-item">
                        <h2>{{ behavior.name }}</h2>
                        <p><strong>Type:</strong> {{ behavior.type }}</p>
                        <p><strong>Point Worth:</strong> {{ behavior.point_value }}</p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No behaviors available. Please add a new one.</p>
        {% endif %}
    </div>

    <!-- Sidebar column for adding a new behavior -->
    <div style="flex: 30%; padding-left: 20px; border-left: 1px solid #ccc; background-color: #2b2b2b; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);">

    <button style="background-color: #4a90e2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;" onclick="document.getElementById('new-behavior-form').style.display='block'">
        Add New Behavior
    </button>

    <!-- Form for adding a new behavior -->
    <div id="new-behavior-form" style="display:none; margin-top: 20px;">
        <form id="behavior-form" method="POST" action="{{ url_for('main.reward_system') }}">
            {{ form.hidden_tag() }}
            
            <div style="margin-bottom: 15px;">
                <label for="name">Behavior Name</label>
                {{ form.name(class="form-control", style="width: 100%;") }}
            </div>

            <div style="margin-bottom: 15px;">
                <label for="type">Behavior Type</label>
                {{ form.type(class="form-control", style="width: 100%;") }}
            </div>

            <div style="margin-bottom: 15px;">
                <label for="point_value">Point Worth</label>
                {{ form.point_value(class="form-control", style="width: 100%;") }}
            </div>
            
            <button type="submit" class="btn btn-primary" style="background-color: #4a90e2; cursor: pointer; padding: 10px 20px; border-radius: 5px; border: none; color: white;">
                Add Behavior
            </button>
        </form>
    </div>

    <script>
        document.getElementById('behavior-form').addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent default form submission

            let formData = new FormData(this);

            fetch('{{ url_for("main.reward_system") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update the behavior list dynamically with the new behavior
                    let behaviorList = document.querySelector('.behavior-list');
                    let newBehavior = `
                        <div class="behavior-item">
                            <h2>${data.behavior.name}</h2>
                            <p><strong>Type:</strong> ${data.behavior.type}</p>
                            <p><strong>Point Worth:</strong> ${data.behavior.point_value}</p>
                        </div>
                    `;
                    behaviorList.insertAdjacentHTML('beforeend', newBehavior);  // Append the new behavior

                    // Optionally clear the form fields
                    document.getElementById('behavior-form').reset();
                } else {
                    console.error('Failed to add the behavior:', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>

    </div>
</div>
{% endblock %}